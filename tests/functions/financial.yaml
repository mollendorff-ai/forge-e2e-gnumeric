# Financial Functions - All 20 Enterprise-Only Functions
# PMT, PV, FV, NPV, IRR, MIRR, XNPV, XIRR, NPER, RATE,
# DB, DDB, SLN, IPMT, PPMT, ACCRINT, EFFECT, NOMINAL, PRICEDISC, YIELDDISC

_forge_version: "5.0.0"

# Array data for IRR, MIRR, XNPV, XIRR functions
irr_investment:
  values: [-100000, 20000, 24000, 28800, 35200]

irr_simple:
  values: [-10000, 3000, 4200, 6800]

mirr_project:
  values: [-100000, 20000, 24000, 28800, 35200, 43000]

xnpv_values:
  values: [-40000, 10000, 12000, 15000]
  dates: [45292, 45365, 45523, 45626]  # 2024-01-01, 03-15, 08-20, 12-31

xirr_values:
  values: [-10000, 3000, 4000, 5500]
  dates: [45292, 45397, 45535, 45640]  # 2024-01-01, 04-15, 09-01, 12-15

assumptions:
  # PMT - Payment calculation for loans and annuities
  test_pmt_mortgage:
    value: null
    formula: "=ROUND(PMT(0.06/12, 360, 200000), 2)"
    expected: -1199.10

  test_pmt_car_loan:
    value: null
    formula: "=ROUND(PMT(0.05/12, 60, 25000), 2)"
    expected: -471.78

  test_pmt_zero_rate:
    value: null
    formula: "=ROUND(PMT(0, 12, 12000), 2)"
    expected: -1000.00

  # PV - Present value
  test_pv_annuity:
    value: null
    formula: "=ROUND(PV(0.08/12, 60, -1000), 2)"
    expected: 49318.43

  test_pv_lump_sum:
    value: null
    formula: "=ROUND(PV(0.10, 5, 0, -10000), 2)"
    expected: 6209.21

  test_pv_zero_rate:
    value: null
    formula: "=ROUND(PV(0, 10, -500, 0), 2)"
    expected: 5000.00

  # FV - Future value
  test_fv_savings:
    value: null
    formula: "=ROUND(FV(0.05/12, 120, -100, 0), 2)"
    expected: 15528.23

  test_fv_lump_sum:
    value: null
    formula: "=ROUND(FV(0.10, 10, 0, -1000), 2)"
    expected: 2593.74

  test_fv_zero_rate:
    value: null
    formula: "=ROUND(FV(0, 12, -100, 0), 2)"
    expected: 1200.00

  # NPV - Net present value
  test_npv_project:
    value: null
    formula: "=ROUND(NPV(0.1, 3000, 4200, 6800), 2)"
    expected: 11307.29  # Validated against forge

  test_npv_simple:
    value: null
    formula: "=ROUND(NPV(0.05, 1000, 1000, 1000), 2)"
    expected: 2723.25

  test_npv_zero_rate:
    value: null
    formula: "=ROUND(NPV(0, 1000, 2000, 3000), 2)"
    expected: 6000.00

  # NPER - Number of periods
  test_nper_loan:
    value: null
    formula: "=ROUND(NPER(0.06/12, -200, 10000), 1)"
    expected: 57.7

  test_nper_savings:
    value: null
    formula: "=ROUND(NPER(0.05/12, -100, 0, 10000), 1)"
    expected: 83.8  # Validated against forge

  test_nper_one_period:
    value: null
    formula: "=ROUND(NPER(0.10, -110, 100), 0)"
    expected: 1.0

  # RATE - Interest rate
  test_rate_loan:
    value: null
    formula: "=ROUND(RATE(48, -500, 20000) * 100, 2)"
    expected: 0.77

  test_rate_investment:
    value: null
    formula: "=ROUND(RATE(10, 0, -1000, 2000) * 100, 2)"
    expected: 7.18

  test_rate_simple:
    value: null
    formula: "=ROUND(RATE(12, -100, 1000) * 100, 2)"
    expected: 2.92

  # SLN - Straight-line depreciation
  test_sln_equipment:
    value: null
    formula: "=ROUND(SLN(30000, 7500, 10), 2)"
    expected: 2250.00

  test_sln_vehicle:
    value: null
    formula: "=ROUND(SLN(100000, 10000, 5), 2)"
    expected: 18000.00

  test_sln_zero_salvage:
    value: null
    formula: "=ROUND(SLN(50000, 0, 10), 2)"
    expected: 5000.00

  # DDB - Double declining balance depreciation
  test_ddb_year1:
    value: null
    formula: "=ROUND(DDB(1000000, 100000, 6, 1), 2)"
    expected: 333333.33

  test_ddb_year2:
    value: null
    formula: "=ROUND(DDB(1000000, 100000, 6, 2), 2)"
    expected: 222222.22

  test_ddb_year3:
    value: null
    formula: "=ROUND(DDB(1000000, 100000, 6, 3), 2)"
    expected: 148148.15

  # DB - Fixed declining balance depreciation
  test_db_year1:
    value: null
    formula: "=ROUND(DB(1000000, 100000, 6, 1), 2)"
    expected: 319000.00

  test_db_year2:
    value: null
    formula: "=ROUND(DB(1000000, 100000, 6, 2), 2)"
    expected: 217239.00

  test_db_year3:
    value: null
    formula: "=ROUND(DB(1000000, 100000, 6, 3), 2)"
    expected: 147939.76  # Validated against forge

  # IRR - Internal rate of return
  test_irr_investment:
    value: null
    formula: "=ROUND(IRR(irr_investment.values) * 100, 2)"

  test_irr_simple:
    value: null
    formula: "=ROUND(IRR(irr_simple.values, 0.1) * 100, 2)"

  # MIRR - Modified internal rate of return
  test_mirr_project:
    value: null
    formula: "=ROUND(MIRR(mirr_project.values, 0.10, 0.12) * 100, 2)"

  test_mirr_same_rates:
    value: null
    formula: "=ROUND(MIRR(irr_investment.values, 0.08, 0.08) * 100, 2)"

  # XNPV - Net present value with specific dates
  test_xnpv_basic:
    value: null
    formula: "=ROUND(XNPV(0.09, xnpv_values.values, xnpv_values.dates), 2)"

  test_xnpv_zero_rate:
    value: null
    formula: "=ROUND(XNPV(0, xnpv_values.values, xnpv_values.dates), 2)"
    expected: -3000.00

  # XIRR - Internal rate of return with specific dates
  # Note: forge XIRR takes 2 args (values, dates) - no guess parameter
  test_xirr_basic:
    value: null
    formula: "=ROUND(XIRR(xirr_values.values, xirr_values.dates) * 100, 2)"

  test_xirr_alternate:
    value: null
    formula: "=ROUND(XIRR(irr_simple.values, xirr_values.dates) * 100, 2)"

  # PPMT - Principal payment for a period
  test_ppmt_period1:
    value: null
    formula: "=ROUND(PPMT(0.06/12, 1, 360, 200000), 2)"
    expected: -199.10

  test_ppmt_period60:
    value: null
    formula: "=ROUND(PPMT(0.06/12, 60, 360, 200000), 2)"
    expected: -267.22

  test_ppmt_period1_zero_rate:
    value: null
    formula: "=ROUND(PPMT(0, 1, 12, 12000), 2)"
    expected: -1000.00

  # IPMT - Interest payment for a period
  test_ipmt_period1:
    value: null
    formula: "=ROUND(IPMT(0.06/12, 1, 360, 200000), 2)"
    expected: -1000.00

  test_ipmt_period60:
    value: null
    formula: "=ROUND(IPMT(0.06/12, 60, 360, 200000), 2)"
    expected: -931.88

  test_ipmt_zero_rate:
    value: null
    formula: "=ROUND(IPMT(0, 1, 12, 12000), 2)"
    expected: 0.00

  # EFFECT - Effective annual interest rate
  test_effect_monthly:
    value: null
    formula: "=ROUND(EFFECT(0.06, 12) * 100, 2)"
    expected: 6.17

  test_effect_quarterly:
    value: null
    formula: "=ROUND(EFFECT(0.08, 4) * 100, 2)"
    expected: 8.24

  test_effect_annual:
    value: null
    formula: "=ROUND(EFFECT(0.10, 1) * 100, 2)"
    expected: 10.00

  # NOMINAL - Nominal annual interest rate
  test_nominal_monthly:
    value: null
    formula: "=ROUND(NOMINAL(0.0617, 12) * 100, 2)"
    expected: 6.00

  test_nominal_quarterly:
    value: null
    formula: "=ROUND(NOMINAL(0.0824, 4) * 100, 2)"
    expected: 8.00

  test_nominal_annual:
    value: null
    formula: "=ROUND(NOMINAL(0.10, 1) * 100, 2)"
    expected: 10.00

  # PRICEDISC - Price of a discounted security
  test_pricedisc_tbill_180:
    value: null
    formula: "=ROUND(PRICEDISC(0, 180, 0.05, 100), 2)"
    expected: 97.50

  test_pricedisc_tbill_360:
    value: null
    formula: "=ROUND(PRICEDISC(0, 360, 0.06, 100), 2)"
    expected: 94.00

  test_pricedisc_90_days:
    value: null
    formula: "=ROUND(PRICEDISC(0, 90, 0.04, 1000), 2)"
    expected: 990.00

  # YIELDDISC - Annual yield of a discounted security
  test_yielddisc_tbill_180:
    value: null
    formula: "=ROUND(YIELDDISC(0, 180, 97.50, 100) * 100, 2)"
    expected: 5.13

  test_yielddisc_tbill_360:
    value: null
    formula: "=ROUND(YIELDDISC(0, 360, 94.00, 100) * 100, 2)"
    expected: 6.38

  test_yielddisc_90_days:
    value: null
    formula: "=ROUND(YIELDDISC(0, 90, 990, 1000) * 100, 2)"
    expected: 4.04

  # ACCRINT - Accrued interest for periodic interest security
  test_accrint_annual:
    value: null
    formula: "=ROUND(ACCRINT(0, 365, 180, 0.06, 1000, 1), 2)"
    expected: 30.00

  test_accrint_semiannual:
    value: null
    formula: "=ROUND(ACCRINT(0, 180, 90, 0.08, 10000, 2), 2)"
    expected: 200.00

  test_accrint_quarterly:
    value: null
    formula: "=ROUND(ACCRINT(0, 90, 45, 0.10, 5000, 4), 2)"
    expected: 62.50
