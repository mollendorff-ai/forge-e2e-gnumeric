# E2E Forge Native Function Tests
# All 8 functions are enterprise-only features
# VARIANCE, VARIANCE_PCT, VARIANCE_STATUS, BREAKEVEN_UNITS, BREAKEVEN_REVENUE, YD, YM, MD

_forge_version: "1.0.0"

assumptions:
  # ══════════════════════════════════════════════════════════════════════
  # VARIANCE FUNCTIONS (3) - Budget vs Actual Analysis
  # ══════════════════════════════════════════════════════════════════════

  # VARIANCE: Simple variance calculation (actual - budget)
  test_variance_positive_simple:
    value: null
    formula: "=VARIANCE(100, 90)"
    expected: 10

  test_variance_negative:
    value: null
    formula: "=VARIANCE(90, 100)"
    expected: -10

  test_variance_zero:
    value: null
    formula: "=VARIANCE(100, 100)"
    expected: 0

  # VARIANCE_PCT: Percentage variance ((actual - budget) / budget)
  test_variance_pct_positive:
    value: null
    formula: "=ROUND(VARIANCE_PCT(110, 100), 2)"
    expected: 0.1

  test_variance_pct_negative:
    value: null
    formula: "=ROUND(VARIANCE_PCT(90, 100), 2)"
    expected: -0.1

  test_variance_pct_large:
    value: null
    formula: "=VARIANCE_PCT(200, 100)"
    expected: 1.0

  # VARIANCE_STATUS: Returns -1 (under), 0 (on target), 1 (over)
  test_variance_status_favorable:
    value: null
    formula: "=VARIANCE_STATUS(110, 100)"
    expected: 1

  test_variance_status_unfavorable:
    value: null
    formula: "=VARIANCE_STATUS(80, 100)"
    expected: -1

  test_variance_status_on_target:
    value: null
    formula: "=VARIANCE_STATUS(100.5, 100)"
    expected: 0

  test_variance_status_with_threshold:
    value: null
    formula: "=VARIANCE_STATUS(105, 100, 0.10)"
    expected: 0

  test_variance_status_cost_favorable:
    value: null
    formula: "=VARIANCE_STATUS(90, 100, \"cost\")"
    expected: 1

  # ══════════════════════════════════════════════════════════════════════
  # BREAKEVEN FUNCTIONS (2) - Financial Analysis
  # ══════════════════════════════════════════════════════════════════════

  # BREAKEVEN_UNITS: Fixed costs / (Price - Variable cost per unit)
  test_breakeven_units_basic:
    value: null
    formula: "=BREAKEVEN_UNITS(50000, 100, 60)"
    expected: 1250

  test_breakeven_units_high_margin:
    value: null
    formula: "=BREAKEVEN_UNITS(10000, 100, 20)"
    expected: 125

  test_breakeven_units_low_margin:
    value: null
    formula: "=BREAKEVEN_UNITS(10000, 100, 90)"
    expected: 1000

  test_breakeven_units_zero_fixed:
    value: null
    formula: "=BREAKEVEN_UNITS(0, 100, 60)"
    expected: 0

  # BREAKEVEN_REVENUE: Fixed costs / Contribution margin percentage
  test_breakeven_revenue_basic:
    value: null
    formula: "=BREAKEVEN_REVENUE(50000, 0.40)"
    expected: 125000

  test_breakeven_revenue_high_margin:
    value: null
    formula: "=BREAKEVEN_REVENUE(10000, 0.80)"
    expected: 12500

  test_breakeven_revenue_low_margin:
    value: null
    formula: "=BREAKEVEN_REVENUE(10000, 0.10)"
    expected: 100000

  test_breakeven_revenue_zero_fixed:
    value: null
    formula: "=BREAKEVEN_REVENUE(0, 0.40)"
    expected: 0

  # ══════════════════════════════════════════════════════════════════════
  # DATE DIFFERENCE FUNCTIONS (3) - YD, YM, MD
  # These are shorthand functions for DATEDIF with specific units
  # ══════════════════════════════════════════════════════════════════════

  # YD: Years and Days - Days between dates ignoring years
  # Implementation note: Test via DATEDIF with "YD" unit
  test_yd_same_year:
    value: null
    formula: "=DATEDIF(DATE(2024,1,1), DATE(2024,6,15), \"YD\")"
    expected: 166  # Jan 1 to Jun 15: 30+29+31+30+31+15 = 166 days

  test_yd_cross_year:
    value: null
    formula: "=DATEDIF(DATE(2024,10,1), DATE(2025,3,15), \"YD\")"
    expected: 165

  test_yd_full_year:
    value: null
    formula: "=DATEDIF(DATE(2024,3,1), DATE(2025,3,1), \"YD\")"
    expected: 0

  # YM: Years and Months - Months between dates ignoring years
  # Implementation note: Test via DATEDIF with "YM" unit
  test_ym_same_year:
    value: null
    formula: "=DATEDIF(DATE(2024,1,15), DATE(2024,6,15), \"YM\")"
    expected: 5

  test_ym_cross_year:
    value: null
    formula: "=DATEDIF(DATE(2024,10,15), DATE(2025,3,15), \"YM\")"
    expected: 5

  test_ym_same_month:
    value: null
    formula: "=DATEDIF(DATE(2024,1,1), DATE(2024,1,31), \"YM\")"
    expected: 0

  # MD: Months and Days - Days between dates ignoring months and years
  # Implementation note: Test via DATEDIF with "MD" unit
  test_md_same_month:
    value: null
    formula: "=DATEDIF(DATE(2024,1,10), DATE(2024,1,25), \"MD\")"
    expected: 15

  test_md_cross_month:
    value: null
    formula: "=DATEDIF(DATE(2024,1,25), DATE(2024,2,10), \"MD\")"
    expected: 16

  test_md_same_day:
    value: null
    formula: "=DATEDIF(DATE(2024,1,15), DATE(2024,6,15), \"MD\")"
    expected: 0
