# E2E Text Function Tests
# Validated against Gnumeric
# Note: Text functions return strings - we wrap with LEN for numeric validation
# Note: String literals with letters (e.g., "Hello") require enterprise schema

_forge_version: "1.0.0"

assumptions:
  # ══════════════════════════════════════════════════════════════════════════
  # LEN - Text length (Demo)
  # ══════════════════════════════════════════════════════════════════════════
  test_len_empty:
    value: null
    formula: "=LEN(\"\")"
    expected: 0

  test_len_spaces:
    value: null
    formula: "=LEN(\"  \")"
    expected: 2

  test_len_basic:
    value: null
    formula: "=LEN(\"Hello\")"
    expected: 5

  test_len_with_spaces:
    value: null
    formula: "=LEN(\"Hello World\")"
    expected: 11

  test_len_numbers:
    value: null
    formula: "=LEN(\"12345\")"
    expected: 5

  test_len_unicode:
    value: null
    formula: "=LEN(\"Hello\")"
    expected: 5

  # ══════════════════════════════════════════════════════════════════════════
  # LEFT - Left characters (Demo)
  # ══════════════════════════════════════════════════════════════════════════
  test_left_two:
    value: null
    formula: "=LEN(LEFT(\"12345\", 2))"
    expected: 2

  test_left_full:
    value: null
    formula: "=LEN(LEFT(\"Hello\", 5))"
    expected: 5

  test_left_exceed:
    value: null
    formula: "=LEN(LEFT(\"Hi\", 10))"
    expected: 2

  test_left_zero:
    value: null
    formula: "=LEN(LEFT(\"Hello\", 0))"
    expected: 0

  test_left_one:
    value: null
    formula: "=LEN(LEFT(\"ABC\", 1))"
    expected: 1

  # ══════════════════════════════════════════════════════════════════════════
  # RIGHT - Right characters (Demo)
  # ══════════════════════════════════════════════════════════════════════════
  test_right_three:
    value: null
    formula: "=LEN(RIGHT(\"12345\", 3))"
    expected: 3

  test_right_full:
    value: null
    formula: "=LEN(RIGHT(\"Hello\", 5))"
    expected: 5

  test_right_exceed:
    value: null
    formula: "=LEN(RIGHT(\"Hi\", 10))"
    expected: 2

  test_right_zero:
    value: null
    formula: "=LEN(RIGHT(\"Hello\", 0))"
    expected: 0

  test_right_one:
    value: null
    formula: "=LEN(RIGHT(\"ABC\", 1))"
    expected: 1

  # ══════════════════════════════════════════════════════════════════════════
  # MID - Middle characters (Demo)
  # ══════════════════════════════════════════════════════════════════════════
  test_mid_basic:
    value: null
    formula: "=LEN(MID(\"12345\", 2, 2))"
    expected: 2

  test_mid_from_start:
    value: null
    formula: "=LEN(MID(\"Hello\", 1, 3))"
    expected: 3

  test_mid_to_end:
    value: null
    formula: "=LEN(MID(\"Hello World\", 7, 5))"
    expected: 5

  test_mid_exceed:
    value: null
    formula: "=LEN(MID(\"Hi\", 1, 10))"
    expected: 2

  test_mid_zero_length:
    value: null
    formula: "=LEN(MID(\"Hello\", 2, 0))"
    expected: 0

  # ══════════════════════════════════════════════════════════════════════════
  # UPPER - Uppercase text (Demo)
  # ══════════════════════════════════════════════════════════════════════════
  test_upper_lowercase:
    value: null
    formula: "=LEN(UPPER(\"hello\"))"
    expected: 5

  test_upper_mixed:
    value: null
    formula: "=LEN(UPPER(\"HeLLo\"))"
    expected: 5

  test_upper_already:
    value: null
    formula: "=LEN(UPPER(\"HELLO\"))"
    expected: 5

  test_upper_numbers:
    value: null
    formula: "=LEN(UPPER(\"abc123\"))"
    expected: 6

  test_upper_spaces:
    value: null
    formula: "=LEN(UPPER(\"a b c\"))"
    expected: 5

  # ══════════════════════════════════════════════════════════════════════════
  # LOWER - Lowercase text (Demo)
  # ══════════════════════════════════════════════════════════════════════════
  test_lower_uppercase:
    value: null
    formula: "=LEN(LOWER(\"HELLO\"))"
    expected: 5

  test_lower_mixed:
    value: null
    formula: "=LEN(LOWER(\"HeLLo\"))"
    expected: 5

  test_lower_already:
    value: null
    formula: "=LEN(LOWER(\"hello\"))"
    expected: 5

  test_lower_numbers:
    value: null
    formula: "=LEN(LOWER(\"ABC123\"))"
    expected: 6

  test_lower_spaces:
    value: null
    formula: "=LEN(LOWER(\"A B C\"))"
    expected: 5

  # ══════════════════════════════════════════════════════════════════════════
  # TRIM - Remove extra spaces (Demo)
  # ══════════════════════════════════════════════════════════════════════════
  test_trim_leading:
    value: null
    formula: "=LEN(TRIM(\"  Hello\"))"
    expected: 5

  test_trim_trailing:
    value: null
    formula: "=LEN(TRIM(\"Hello  \"))"
    expected: 5

  test_trim_both:
    value: null
    formula: "=LEN(TRIM(\"  Hello  \"))"
    expected: 5

  test_trim_middle:
    value: null
    formula: "=LEN(TRIM(\"Hello  World\"))"
    expected: 11

  test_trim_none:
    value: null
    formula: "=LEN(TRIM(\"Hello\"))"
    expected: 5

  test_trim_only_spaces:
    value: null
    formula: "=LEN(TRIM(\"   \"))"
    expected: 0

  # ══════════════════════════════════════════════════════════════════════════
  # CONCAT - Join strings (Demo)
  # ══════════════════════════════════════════════════════════════════════════
  test_concat_two:
    value: null
    formula: "=LEN(CONCAT(\"12\", \"34\"))"
    expected: 4

  test_concat_three:
    value: null
    formula: "=LEN(CONCAT(\"A\", \"B\", \"C\"))"
    expected: 3

  test_concat_empty:
    value: null
    formula: "=LEN(CONCAT(\"\", \"Hello\", \"\"))"
    expected: 5

  test_concat_spaces:
    value: null
    formula: "=LEN(CONCAT(\"Hello\", \" \", \"World\"))"
    expected: 11

  test_concat_single:
    value: null
    formula: "=LEN(CONCAT(\"Hello\"))"
    expected: 5

  # ══════════════════════════════════════════════════════════════════════════
  # REPT - Repeat text (Demo)
  # ══════════════════════════════════════════════════════════════════════════
  test_rept_three:
    value: null
    formula: "=LEN(REPT(\"12\", 3))"
    expected: 6

  test_rept_five:
    value: null
    formula: "=LEN(REPT(\"A\", 5))"
    expected: 5

  test_rept_zero:
    value: null
    formula: "=LEN(REPT(\"Hello\", 0))"
    expected: 0

  test_rept_one:
    value: null
    formula: "=LEN(REPT(\"Hi\", 1))"
    expected: 2

  test_rept_large:
    value: null
    formula: "=LEN(REPT(\"X\", 100))"
    expected: 100

  # ══════════════════════════════════════════════════════════════════════════
  # CONCATENATE - Alias for CONCAT (Enterprise)
  # ══════════════════════════════════════════════════════════════════════════
  test_concatenate_two:
    value: null
    formula: "=LEN(CONCATENATE(\"12\", \"34\"))"
    expected: 4

  test_concatenate_three:
    value: null
    formula: "=LEN(CONCATENATE(\"A\", \"B\", \"C\"))"
    expected: 3

  test_concatenate_spaces:
    value: null
    formula: "=LEN(CONCATENATE(\"Hello\", \" \", \"World\"))"
    expected: 11

  # ══════════════════════════════════════════════════════════════════════════
  # VALUE - Convert text to number (Enterprise)
  # ══════════════════════════════════════════════════════════════════════════
  test_value_integer:
    value: null
    formula: "=VALUE(\"123\")"
    expected: 123

  test_value_decimal:
    value: null
    formula: "=VALUE(\"123.45\")"
    expected: 123.45

  test_value_negative:
    value: null
    formula: "=VALUE(\"-456.78\")"
    expected: -456.78

  test_value_zero:
    value: null
    formula: "=VALUE(\"0\")"
    expected: 0

  test_value_with_spaces:
    value: null
    formula: "=VALUE(\" 123 \")"
    expected: 123

  test_value_scientific:
    value: null
    formula: "=VALUE(\"1.23E+2\")"
    expected: 123

  # ══════════════════════════════════════════════════════════════════════════
  # FIND - Find text position (case sensitive) (Enterprise)
  # ══════════════════════════════════════════════════════════════════════════
  test_find_basic:
    value: null
    formula: "=FIND(\"o\", \"Hello\")"
    expected: 5

  test_find_first:
    value: null
    formula: "=FIND(\"H\", \"Hello\")"
    expected: 1

  test_find_space:
    value: null
    formula: "=FIND(\" \", \"Hello World\")"
    expected: 6

  test_find_with_start:
    value: null
    formula: "=FIND(\"o\", \"Hello World\", 6)"
    expected: 8

  test_find_number:
    value: null
    formula: "=FIND(\"3\", \"12345\")"
    expected: 3

  # ══════════════════════════════════════════════════════════════════════════
  # SEARCH - Find text position (case insensitive) (Enterprise)
  # ══════════════════════════════════════════════════════════════════════════
  test_search_basic:
    value: null
    formula: "=SEARCH(\"o\", \"Hello\")"
    expected: 5

  test_search_case_insensitive:
    value: null
    formula: "=SEARCH(\"h\", \"Hello\")"
    expected: 1

  test_search_with_start:
    value: null
    formula: "=SEARCH(\"o\", \"Hello World\", 6)"
    expected: 8

  test_search_space:
    value: null
    formula: "=SEARCH(\" \", \"Hello World\")"
    expected: 6

  test_search_number:
    value: null
    formula: "=SEARCH(\"4\", \"12345\")"
    expected: 4

  # ══════════════════════════════════════════════════════════════════════════
  # REPLACE - Replace characters (Enterprise)
  # ══════════════════════════════════════════════════════════════════════════
  test_replace_basic:
    value: null
    formula: "=LEN(REPLACE(\"Hello\", 2, 2, \"XX\"))"
    expected: 5

  test_replace_start:
    value: null
    formula: "=LEN(REPLACE(\"Hello\", 1, 1, \"YY\"))"
    expected: 6

  test_replace_end:
    value: null
    formula: "=LEN(REPLACE(\"Hello\", 5, 1, \"XXX\"))"
    expected: 7

  test_replace_expand:
    value: null
    formula: "=LEN(REPLACE(\"Hi\", 2, 1, \"ello\"))"
    expected: 5

  test_replace_shrink:
    value: null
    formula: "=LEN(REPLACE(\"Hello\", 2, 3, \"i\"))"
    expected: 3

  test_replace_empty:
    value: null
    formula: "=LEN(REPLACE(\"Hello\", 2, 2, \"\"))"
    expected: 3

  # ══════════════════════════════════════════════════════════════════════════
  # SUBSTITUTE - Substitute text (Enterprise)
  # ══════════════════════════════════════════════════════════════════════════
  test_substitute_basic:
    value: null
    formula: "=LEN(SUBSTITUTE(\"Hello\", \"l\", \"L\"))"
    expected: 5

  test_substitute_all:
    value: null
    formula: "=LEN(SUBSTITUTE(\"aaa\", \"a\", \"bb\"))"
    expected: 6

  test_substitute_first:
    value: null
    formula: "=LEN(SUBSTITUTE(\"aaa\", \"a\", \"bb\", 1))"
    expected: 4

  test_substitute_second:
    value: null
    formula: "=LEN(SUBSTITUTE(\"aaa\", \"a\", \"bb\", 2))"
    expected: 4

  test_substitute_none:
    value: null
    formula: "=LEN(SUBSTITUTE(\"Hello\", \"x\", \"y\"))"
    expected: 5

  test_substitute_empty:
    value: null
    formula: "=LEN(SUBSTITUTE(\"Hello\", \"l\", \"\"))"
    expected: 3

  # ══════════════════════════════════════════════════════════════════════════
  # TEXT - Format number as text (Enterprise)
  # ══════════════════════════════════════════════════════════════════════════
  test_text_basic:
    value: null
    formula: "=LEN(TEXT(1234.5, \"0.00\"))"
    expected: 7

  test_text_integer:
    value: null
    formula: "=LEN(TEXT(123, \"0\"))"
    expected: 3

  test_text_decimal:
    value: null
    formula: "=LEN(TEXT(123.456, \"0.00\"))"
    expected: 6

  test_text_negative:
    value: null
    formula: "=LEN(TEXT(-123, \"0\"))"
    expected: 4

  test_text_zero:
    value: null
    formula: "=LEN(TEXT(0, \"0.00\"))"
    expected: 4
