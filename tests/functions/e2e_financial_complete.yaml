# E2E Financial Function Complete Coverage
# v7.1.0 - All 20 financial functions with 41 comprehensive test cases
# PMT, PV, FV, NPV, IRR, MIRR, XNPV, XIRR, NPER, RATE, DB, DDB, SLN,
# PPMT, IPMT, EFFECT, NOMINAL, PRICEDISC, YIELDDISC, ACCRINT

_forge_version: "5.0.0"

# ═══════════════════════════════════════════════════════════════════════════
# TABLE DATA - Cash flows and dates for array-based financial functions
# ═══════════════════════════════════════════════════════════════════════════

# IRR Test Data - Investment with returns
irr_cash_flows:
  values: [-100000, 20000, 24000, 28800, 35200]

# IRR Project Data - Smaller project with higher returns
irr_project_flows:
  values: [-50000, 12000, 15000, 18000, 21000, 24000]

# MIRR Test Data - Investment with returns
mirr_cash_flows:
  values: [-100000, 20000, 24000, 28800, 35200, 43000]

# MIRR Conservative Data
mirr_conservative_flows:
  values: [-50000, 12000, 15000, 18000, 21000]

# XNPV Test Data - Values and corresponding dates (Excel serial format)
xnpv_basic_data:
  values: [-40000, 10000, 12000, 15000]
  dates: [45292, 45365, 45523, 45626]  # 2024-01-01, 2024-03-15, 2024-08-20, 2024-12-31

# XNPV Project Data
xnpv_project_data:
  values: [-100000, 25000, 30000, 35000, 40000]
  dates: [45292, 45400, 45550, 45700, 45850]  # Irregular intervals

# XIRR Basic Data
xirr_basic_data:
  values: [-10000, 3000, 4000, 5500]
  dates: [45292, 45397, 45535, 45640]  # 2024-01-01, 2024-04-15, 2024-09-01, 2024-12-15

# XIRR Investment Data
xirr_investment_data:
  values: [-10000, 2800, 3200, 3800, 4200]
  dates: [45292, 45382, 45475, 45565, 45840]  # 18-month period with irregular timing

assumptions:
  # ═══════════════════════════════════════════════════════════════════════════
  # PMT - Payment calculation
  # ═══════════════════════════════════════════════════════════════════════════
  pmt_mortgage:
    value: null
    formula: "=ROUND(PMT(0.06/12, 360, 200000), 2)"  # ~-1199.10
  pmt_car_loan:
    value: null
    formula: "=ROUND(PMT(0.05/12, 60, 25000), 2)"    # ~-471.78
  pmt_zero_rate:
    value: null
    formula: "=ROUND(PMT(0, 12, 12000), 2)"          # -1000 (simple division)

  # ═══════════════════════════════════════════════════════════════════════════
  # PV - Present value
  # ═══════════════════════════════════════════════════════════════════════════
  pv_annuity:
    value: null
    formula: "=ROUND(PV(0.08/12, 60, -1000), 2)"     # ~49318.43
  pv_investment:
    value: null
    formula: "=ROUND(PV(0.10, 5, 0, -10000), 2)"     # ~6209.21

  # ═══════════════════════════════════════════════════════════════════════════
  # FV - Future value
  # ═══════════════════════════════════════════════════════════════════════════
  fv_savings:
    value: null
    formula: "=ROUND(FV(0.05/12, 120, -100, 0), 2)"  # ~15528.23
  fv_investment:
    value: null
    formula: "=ROUND(FV(0.10, 10, 0, -1000), 2)"     # ~2593.74

  # ═══════════════════════════════════════════════════════════════════════════
  # NPV - Net present value
  # ═══════════════════════════════════════════════════════════════════════════
  npv_project:
    value: null
    formula: "=ROUND(NPV(0.1, 3000, 4200, 6800), 2)" # ~11308.20
  npv_simple:
    value: null
    formula: "=ROUND(NPV(0.05, 1000, 1000, 1000), 2)" # ~2723.25

  # ═══════════════════════════════════════════════════════════════════════════
  # RATE - Interest rate
  # ═══════════════════════════════════════════════════════════════════════════
  rate_loan:
    value: null
    formula: "=ROUND(RATE(48, -500, 20000) * 100, 2)" # ~0.77%
  rate_investment:
    value: null
    formula: "=ROUND(RATE(10, 0, -1000, 2000) * 100, 2)" # ~7.18%

  # ═══════════════════════════════════════════════════════════════════════════
  # NPER - Number of periods
  # ═══════════════════════════════════════════════════════════════════════════
  nper_loan:
    value: null
    formula: "=ROUND(NPER(0.06/12, -200, 10000), 1)" # ~57.7
  nper_savings:
    value: null
    formula: "=ROUND(NPER(0.05/12, -100, 0, 10000), 1)" # ~82.0

  # ═══════════════════════════════════════════════════════════════════════════
  # SLN - Straight-line depreciation
  # ═══════════════════════════════════════════════════════════════════════════
  sln_asset:
    value: null
    formula: "=ROUND(SLN(30000, 7500, 10), 2)"       # 2250
  sln_equipment:
    value: null
    formula: "=ROUND(SLN(100000, 10000, 5), 2)"      # 18000

  # ═══════════════════════════════════════════════════════════════════════════
  # DDB - Double declining balance depreciation
  # ═══════════════════════════════════════════════════════════════════════════
  ddb_year1:
    value: null
    formula: "=ROUND(DDB(1000000, 100000, 6, 1), 2)" # ~333333.33
  ddb_year2:
    value: null
    formula: "=ROUND(DDB(1000000, 100000, 6, 2), 2)" # ~222222.22

  # ═══════════════════════════════════════════════════════════════════════════
  # DB - Fixed declining balance depreciation
  # ═══════════════════════════════════════════════════════════════════════════
  db_year1:
    value: null
    formula: "=ROUND(DB(1000000, 100000, 6, 1), 2)"  # ~319000
  db_year2:
    value: null
    formula: "=ROUND(DB(1000000, 100000, 6, 2), 2)"  # ~217239

  # ═══════════════════════════════════════════════════════════════════════════
  # IRR - Internal rate of return (requires array context)
  # ═══════════════════════════════════════════════════════════════════════════
  # IRR calculates the internal rate of return for a series of cash flows
  # Syntax: IRR(values, [guess])
  # Cash flows: [-100000, 20000, 24000, 28800, 35200]

  irr_basic:
    value: null
    formula: "=ROUND(IRR(irr_cash_flows.values) * 100, 2)"  # REAL IRR call!

  irr_project:
    value: null
    formula: "=ROUND(IRR(irr_project_flows.values, 0.1) * 100, 2)"  # REAL IRR with guess!

  # ═══════════════════════════════════════════════════════════════════════════
  # MIRR - Modified internal rate of return (requires array context)
  # ═══════════════════════════════════════════════════════════════════════════
  # MIRR calculates modified IRR with different rates for financing and reinvestment
  # Syntax: MIRR(values, finance_rate, reinvest_rate)
  # Cash flows: [-100000, 20000, 24000, 28800, 35200, 43000]

  mirr_basic:
    value: null
    formula: "=ROUND(MIRR(mirr_cash_flows.values, 0.10, 0.12) * 100, 2)"  # REAL MIRR call!

  mirr_conservative:
    value: null
    formula: "=ROUND(MIRR(mirr_conservative_flows.values, 0.08, 0.08) * 100, 2)"  # REAL MIRR call!

  # ═══════════════════════════════════════════════════════════════════════════
  # XNPV - Net present value with specific dates (requires array context)
  # ═══════════════════════════════════════════════════════════════════════════
  # XNPV calculates NPV using actual payment dates instead of periodic intervals
  # Syntax: XNPV(rate, values, dates)
  # More accurate than NPV when cash flows occur at irregular intervals

  xnpv_basic:
    value: null
    formula: "=ROUND(XNPV(0.09, xnpv_basic_data.values, xnpv_basic_data.dates), 2)"  # REAL XNPV call!

  xnpv_project:
    value: null
    formula: "=ROUND(XNPV(0.12, xnpv_project_data.values, xnpv_project_data.dates), 2)"  # REAL XNPV call!

  # ═══════════════════════════════════════════════════════════════════════════
  # XIRR - Internal rate of return with specific dates (requires array context)
  # ═══════════════════════════════════════════════════════════════════════════
  # XIRR calculates IRR using actual payment dates instead of periodic intervals
  # Syntax: XIRR(values, dates, [guess])
  # Essential for investments with irregular cash flow timing

  xirr_basic:
    value: null
    formula: "=ROUND(XIRR(xirr_basic_data.values, xirr_basic_data.dates) * 100, 2)"  # REAL XIRR call!

  xirr_investment:
    value: null
    formula: "=ROUND(XIRR(xirr_investment_data.values, xirr_investment_data.dates) * 100, 2)"  # REAL XIRR call!

  # ═══════════════════════════════════════════════════════════════════════════
  # PPMT - Principal payment for a period
  # ═══════════════════════════════════════════════════════════════════════════
  ppmt_period_1:
    value: null
    formula: "=ROUND(PPMT(0.06/12, 1, 360, 200000), 2)"  # ~-199.10 (principal in month 1)
  ppmt_period_60:
    value: null
    formula: "=ROUND(PPMT(0.06/12, 60, 360, 200000), 2)"  # ~-267.22 (higher principal later)

  # ═══════════════════════════════════════════════════════════════════════════
  # IPMT - Interest payment for a period
  # ═══════════════════════════════════════════════════════════════════════════
  ipmt_period_1:
    value: null
    formula: "=ROUND(IPMT(0.06/12, 1, 360, 200000), 2)"  # ~-1000 (interest payment in month 1)
  ipmt_period_60:
    value: null
    formula: "=ROUND(IPMT(0.06/12, 60, 360, 200000), 2)"  # Lower interest payment later

  # ═══════════════════════════════════════════════════════════════════════════
  # EFFECT - Effective annual interest rate
  # ═══════════════════════════════════════════════════════════════════════════
  effect_monthly:
    value: null
    formula: "=ROUND(EFFECT(0.06, 12) * 100, 2)"  # ~6.17% (6% compounded monthly)
  effect_quarterly:
    value: null
    formula: "=ROUND(EFFECT(0.08, 4) * 100, 2)"   # ~8.24% (8% compounded quarterly)

  # ═══════════════════════════════════════════════════════════════════════════
  # NOMINAL - Nominal annual interest rate
  # ═══════════════════════════════════════════════════════════════════════════
  nominal_monthly:
    value: null
    formula: "=ROUND(NOMINAL(0.0617, 12) * 100, 2)"  # ~6.00% (inverse of EFFECT)
  nominal_quarterly:
    value: null
    formula: "=ROUND(NOMINAL(0.0824, 4) * 100, 2)"   # ~8.00% (inverse of EFFECT)

  # ═══════════════════════════════════════════════════════════════════════════
  # PRICEDISC - Price of a discounted security
  # ═══════════════════════════════════════════════════════════════════════════
  pricedisc_tbill:
    value: null
    formula: "=ROUND(PRICEDISC(0, 180, 0.05, 100), 2)"  # ~97.50 ($100 face, 5% discount, 180 days)
  pricedisc_360:
    value: null
    formula: "=ROUND(PRICEDISC(0, 360, 0.06, 100), 2)"  # ~94.00 ($100 face, 6% discount, 360 days)

  # ═══════════════════════════════════════════════════════════════════════════
  # YIELDDISC - Annual yield of a discounted security
  # ═══════════════════════════════════════════════════════════════════════════
  yielddisc_tbill:
    value: null
    formula: "=ROUND(YIELDDISC(0, 180, 97.50, 100) * 100, 2)"  # ~5.13% yield
  yielddisc_360:
    value: null
    formula: "=ROUND(YIELDDISC(0, 360, 94.00, 100) * 100, 2)"  # ~6.38% yield

  # ═══════════════════════════════════════════════════════════════════════════
  # ACCRINT - Accrued interest for periodic interest security
  # ═══════════════════════════════════════════════════════════════════════════
  accrint_annual:
    value: null
    formula: "=ROUND(ACCRINT(0, 365, 180, 0.06, 1000, 1), 2)"  # ~30 (half year of 6% on $1000)
  accrint_semiannual:
    value: null
    formula: "=ROUND(ACCRINT(0, 180, 90, 0.08, 10000, 2), 2)"  # ~200 (quarter year of 8% on $10000)
