# E2E Aggregation Function Complete Coverage
# v7.0.0 - All 14 aggregation functions with comprehensive REAL tests
# FP&A ACCURACY MANDATE - 100% REAL TEST COVERAGE

_forge_version: "5.0.0"

# ═══════════════════════════════════════════════════════════════════════════
# TEST DATA TABLES - Required for array functions
# ═══════════════════════════════════════════════════════════════════════════

aggregation_data:
  values: [10, 50, 30, 70, 20, 90, 40]

ranking_data:
  scores: [85, 90, 78, 92, 88]

sales_data:
  amount: [100, 200, 150, 300, 250]
  region: ["East", "West", "East", "West", "East"]
  quarter: [1, 1, 2, 2, 2]

unique_data:
  values: [10, 20, 10, 30, 20, 40]

assumptions:
  # ═══════════════════════════════════════════════════════════════════════════
  # SUM - Total of values
  # ═══════════════════════════════════════════════════════════════════════════
  eac_sum_basic:
    value: null
    formula: "=SUM(10, 20, 30, 40, 50)"        # Expected: 150
    expected: 150
  eac_sum_negative:
    value: null
    formula: "=SUM(-5, -3, 0, 3, 5)"           # Expected: 0
    expected: 0
  eac_sum_decimal:
    value: null
    formula: "=SUM(1.5, 2.5, 3.0)"             # Expected: 7
    expected: 7
  eac_sum_single:
    value: null
    formula: "=SUM(42)"                         # Expected: 42
    expected: 42

  # ═══════════════════════════════════════════════════════════════════════════
  # AVERAGE / AVG - Mean of values
  # ═══════════════════════════════════════════════════════════════════════════
  eac_avg_basic:
    value: null
    formula: "=AVERAGE(10, 20, 30, 40, 50)"    # Expected: 30
    expected: 30
  eac_avg_alias:
    value: null
    formula: "=AVG(5, 10, 15, 20, 25)"         # Expected: 15
    expected: 15
  eac_avg_decimal:
    value: null
    formula: "=AVERAGE(1.5, 2.5, 3.5)"         # Expected: 2.5
    expected: 2.5
  eac_avg_negative:
    value: null
    formula: "=AVERAGE(-10, 0, 10)"            # Expected: 0
    expected: 0

  # ═══════════════════════════════════════════════════════════════════════════
  # COUNT / COUNTA - Count values
  # ═══════════════════════════════════════════════════════════════════════════
  eac_count_numbers:
    value: null
    formula: "=COUNT(1, 2, 3, 4, 5)"           # Expected: 5
    expected: 5
  eac_count_mixed:
    value: null
    formula: "=COUNT(1, \"a\", 3, \"b\", 5)"   # Expected: 3
    expected: 3
  eac_counta_all:
    value: null
    formula: "=COUNTA(1, \"a\", 3, \"b\", 5)"  # Expected: 5
    expected: 5
  eac_counta_text:
    value: null
    formula: "=COUNTA(\"x\", \"y\", \"z\")"    # Expected: 3
    expected: 3

  # ═══════════════════════════════════════════════════════════════════════════
  # MIN / MAX - Extremes
  # ═══════════════════════════════════════════════════════════════════════════
  eac_min_positive:
    value: null
    formula: "=MIN(5, 3, 8, 1, 9)"             # Expected: 1
    expected: 1
  eac_min_negative:
    value: null
    formula: "=MIN(-5, 3, -8, 1, -9)"          # Expected: -9
    expected: -9
  eac_max_positive:
    value: null
    formula: "=MAX(5, 3, 8, 1, 9)"             # Expected: 9
    expected: 9
  eac_max_negative:
    value: null
    formula: "=MAX(-5, -3, -8, -1, -9)"        # Expected: -1
    expected: -1
  eac_min_decimal:
    value: null
    formula: "=MIN(1.5, 0.5, 2.5)"             # Expected: 0.5
    expected: 0.5
  eac_max_decimal:
    value: null
    formula: "=MAX(1.5, 0.5, 2.5)"             # Expected: 2.5
    expected: 2.5

  # ═══════════════════════════════════════════════════════════════════════════
  # PRODUCT - Multiply all values
  # ═══════════════════════════════════════════════════════════════════════════
  eac_product_basic:
    value: null
    formula: "=PRODUCT(2, 3, 4)"               # Expected: 24
    expected: 24
  eac_product_decimal:
    value: null
    formula: "=PRODUCT(1.5, 2, 3)"             # Expected: 9
    expected: 9
  eac_product_with_one:
    value: null
    formula: "=PRODUCT(5, 1, 1, 1)"            # Expected: 5
    expected: 5
  eac_product_negative:
    value: null
    formula: "=PRODUCT(-2, 3, 4)"              # Expected: -24
    expected: -24

  # ═══════════════════════════════════════════════════════════════════════════
  # LARGE / SMALL - Nth largest/smallest (REAL TESTS)
  # Values: [10, 50, 30, 70, 20, 90, 40] → Sorted desc: [90, 70, 50, 40, 30, 20, 10]
  # ═══════════════════════════════════════════════════════════════════════════
  eac_large_first:
    value: null
    formula: "=LARGE(aggregation_data.values, 1)"   # 1st largest = 90
  eac_large_second:
    value: null
    formula: "=LARGE(aggregation_data.values, 2)"   # 2nd largest = 70
  eac_large_third:
    value: null
    formula: "=LARGE(aggregation_data.values, 3)"   # 3rd largest = 50
  eac_small_first:
    value: null
    formula: "=SMALL(aggregation_data.values, 1)"   # 1st smallest = 10
  eac_small_second:
    value: null
    formula: "=SMALL(aggregation_data.values, 2)"   # 2nd smallest = 20
  eac_small_third:
    value: null
    formula: "=SMALL(aggregation_data.values, 3)"   # 3rd smallest = 30

  # ═══════════════════════════════════════════════════════════════════════════
  # SUMSQ - Sum of squares (manual calculation)
  # ═══════════════════════════════════════════════════════════════════════════
  sumsq_basic:
    value: null
    formula: "=3*3 + 4*4"                      # Expected: 25 (9 + 16)
    expected: 25
  sumsq_multiple:
    value: null
    formula: "=1*1 + 2*2 + 3*3"                # Expected: 14 (1 + 4 + 9)
    expected: 14

  # ═══════════════════════════════════════════════════════════════════════════
  # SUMPRODUCT - Sum of element-wise products (inline)
  # ═══════════════════════════════════════════════════════════════════════════
  sumproduct_manual:
    value: null
    formula: "=1*4 + 2*5 + 3*6"                # Expected: 32
    expected: 32

  # ═══════════════════════════════════════════════════════════════════════════
  # COUNTUNIQUE - Count unique values (REAL TEST)
  # Values: [10, 20, 10, 30, 20, 40] → Unique: [10, 20, 30, 40] = 4
  # ═══════════════════════════════════════════════════════════════════════════
  eac_countunique_basic:
    value: null
    formula: "=COUNTUNIQUE(unique_data.values)"  # Expected: 4
    expected: 4

  # ═══════════════════════════════════════════════════════════════════════════
  # RANK.EQ - Position in sorted list (REAL TESTS)
  # Scores: [85, 90, 78, 92, 88] → Desc: [92, 90, 88, 85, 78] ranks: 1, 2, 3, 4, 5
  # ═══════════════════════════════════════════════════════════════════════════
  rank_92_desc:
    value: null
    formula: "=RANK.EQ(92, ranking_data.scores)"      # Rank 1 (highest)
  rank_90_desc:
    value: null
    formula: "=RANK.EQ(90, ranking_data.scores, 0)"   # Rank 2
  rank_85_desc:
    value: null
    formula: "=RANK(85, ranking_data.scores)"         # Rank 4
  rank_78_asc:
    value: null
    formula: "=RANK.EQ(78, ranking_data.scores, 1)"   # Rank 1 (ascending)
  rank_92_asc:
    value: null
    formula: "=RANK(92, ranking_data.scores, 1)"      # Rank 5 (ascending)

  # ═══════════════════════════════════════════════════════════════════════════
  # MAXIFS / MINIFS - Conditional max/min (REAL TESTS)
  # Amount: [100, 200, 150, 300, 250]
  # Region: [East, West, East, West, East]
  # Quarter: [1, 1, 2, 2, 2]
  # ═══════════════════════════════════════════════════════════════════════════
  eac_maxifs_region_east:
    value: null
    formula: "=MAXIFS(sales_data.amount, sales_data.region, \"East\")"  # Max East = 250
  eac_maxifs_region_west:
    value: null
    formula: "=MAXIFS(sales_data.amount, sales_data.region, \"West\")"  # Max West = 300
  eac_maxifs_east_q2:
    value: null
    formula: "=MAXIFS(sales_data.amount, sales_data.region, \"East\", sales_data.quarter, 2)"  # East+Q2 = 250
  eac_minifs_region_east:
    value: null
    formula: "=MINIFS(sales_data.amount, sales_data.region, \"East\")"  # Min East = 100
  eac_minifs_region_west:
    value: null
    formula: "=MINIFS(sales_data.amount, sales_data.region, \"West\")"  # Min West = 200
  eac_minifs_east_q2:
    value: null
    formula: "=MINIFS(sales_data.amount, sales_data.region, \"East\", sales_data.quarter, 2)"  # East+Q2 = 150

  # ═══════════════════════════════════════════════════════════════════════════
  # Edge cases
  # ═══════════════════════════════════════════════════════════════════════════
  eac_sum_empty_like:
    value: null
    formula: "=0"                              # Empty sum
  eac_avg_single:
    value: null
    formula: "=AVERAGE(42)"                    # Expected: 42
    expected: 42
  eac_min_single:
    value: null
    formula: "=MIN(42)"                        # Expected: 42
    expected: 42
  eac_max_single:
    value: null
    formula: "=MAX(42)"                        # Expected: 42
    expected: 42
